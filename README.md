# Numbers Core

Простой инструмент, который помогает посчитать ваш нумерологический профиль и получить короткое описание от ИИ‑ассистента. Внутри проекта есть:
- «мотор» для расчётов по имени и дате рождения;
- шаблоны сообщений для ИИ и подключение к сервису OpenRouter;
- небольшой веб‑сервер на FastAPI и отдельный интерфейс на Godot (по желанию).

## Что умеет программа
- Находит пять базовых чисел: путь судьбы (life path), число дня рождения, число выражения, души и личности.
- Готовит текстовую интерпретацию на русском языке с понятными рекомендациями.
- Может работать локально (только расчёт) или обращаться к облачной модели через OpenRouter.
- Предоставляет HTTP‑эндпоинт `/profile`, который возвращает расчёт в формате JSON. Это удобно для сторонних приложений.

## Что нужно подготовить
1. **Компьютер с Windows, macOS или Linux.**
2. **Python версии 3.10 и новее.** Скачать можно на https://www.python.org/downloads/
3. **Доступ в интернет.** Нужен, чтобы установить зависимости и отправлять запросы в OpenRouter.
4. **Учётная запись и API‑ключ OpenRouter.** Зарегистрируйтесь на https://openrouter.ai/ и сгенерируйте ключ.
5. (Опционально) **Godot 4**, если хотите использовать графический интерфейс в папке `numbers-gui`.

## Быстрый старт (пошагово)
1. **Скачайте или клонируйте проект.**
2. **Откройте терминал** (PowerShell на Windows, Terminal на macOS/Linux) и перейдите в папку проекта `numbers_bot`.
3. **Создайте виртуальное окружение:**
   ```bash
   python -m venv .venv
   ```
4. **Активируйте окружение:**
   - Windows PowerShell:
     ```bash
     .\.venv\Scripts\activate
     ```
   - macOS/Linux:
     ```bash
     source .venv/bin/activate
     ```
5. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```
6. **Добавьте ключ OpenRouter.** Создайте файл `.env` в корне проекта и вставьте строку:
   ```
   OPENROUTER_API_KEY=ваш_ключ
   ```
   Вместо `ваш_ключ` укажите значение из вашего кабинета OpenRouter. Если не хотите файл, можно выставить переменную в терминале командой `set` (Windows) или `export` (macOS/Linux).

После этих шагов расчёт профиля готов к работе.

## Как получить расчёт и интерпретацию
Самый простой путь — использовать готовый оркестратор:
```python
from numbers_core.core.orchestrator import ProfileInput, run

result = run(ProfileInput(name="Иван Иванов", birthdate="1990-01-01"))
print(result["profile"])            # словарь с числами
print(result["analysis"]["text"])  # текст от ИИ
```
- Поле `profile` содержит пять чисел профиля.
- Поле `analysis` — словарь с ключом `text`, где хранится ответ модели. Если интернет недоступен или ключ не задан, будет возвращено сообщение-заглушка.

## Только расчёт без ИИ
Хотите получить только числа и обойтись без OpenRouter? Подключите модуль расчёта напрямую:
```python
from numbers_core.calc.profile import calculate_core_profile
profile = calculate_core_profile("Иван Иванов", "01.01.1990")
print(profile)
```

## Веб‑сервер (по желанию)
Запустите REST‑API и отправляйте запросы из Postman, браузера или вашего приложения:
```bash
uvicorn api:app --reload --port 8001
```
Пример запроса (POST `http://127.0.0.1:8001/profile`):
```json
{
  "full_name": "Иван Иванов",
  "birthdate": "1990-01-01"
}
```
Ответ будет содержать пять чисел профиля. Для текстового анализа используйте функции из `numbers_core.intelligence`.

## Шаблоны промтов и OpenRouter
- Системный промт: `numbers_core/intelligence/prompts/system.ru.md`
- Пользовательский промт: `numbers_core/intelligence/prompts/numerology.ru.md`
- Функция `prompts.loader.load_prompt` автоматически подставляет профиль в шаблон и возвращает строки для OpenRouter.
- Клиент `OpenRouterClient` берёт ключ из `.env` и отправляет запрос на модель `openai/gpt-5-chat`.

## Тестирование
1. Установите pytest (если ещё нет): `pip install pytest`.
2. Запустите тесты: `pytest numbers_core`

Тесты проверяют расчёт профиля и базовый сценарий оркестратора.

## Godot UI (опционально)
Папка `numbers-gui` содержит проект на Godot. Он общается с FastAPI-сервером и показывает профиль в графическом интерфейсе. Откройте папку в Godot 4 и, при необходимости, скорректируйте адрес сервера в настройках сцены.

## Частые вопросы
**Нужен ли интернет?** Для расчёта чисел — нет. Для текстового анализа через OpenRouter — да.

**Что делать, если терминал говорит «command not found»?** Убедитесь, что активировано виртуальное окружение и Python добавлен в PATH. На Windows помогает перезапуск PowerShell после установки Python.

**Можно ли использовать другой язык?** Сейчас шаблоны подготовлены на русском. При желании можно добавить файлы `system.en.md`, `numerology.en.md` и указать `lang="en"` в `analyze_profile`.

**Где менять тонуса или формат текстов?** Отредактируйте Markdown-файлы в `numbers_core/intelligence/prompts`.

## Где искать помощь
- Проверьте описание модулей в папках `numbers_core/calc`, `numbers_core/core` и `numbers_core/intelligence` — код сопровождается понятными именами функций.
- За вопросами и предложениями создавайте issue или pull request в репозитории.

Удачных расчётов!
