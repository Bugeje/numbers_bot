# Numbers Core

Numbers Core — набор инструментов для расчёта базовых нумерологических показателей и получения текстового разбора с помощью AI.
Проект состоит из нескольких частей:

- `numbers_core` — библиотека с вычислениями, оркестратором и клиентами AI;
- `api.py` — минимальный FastAPI‑сервер, который отдаёт результаты по HTTP;
- `numbers-gui` — интерфейс на Godot 4, который работает поверх API.

## Возможности

- расчёт пяти чисел: путь жизни, число дня рождения, выражение, душа, личность;
- нормализация входных данных (имя и дата в разных форматах);
- проверка валидности имени и даты с понятными подсказками;
- генерация текстового анализа через OpenRouter (или мок‑ответ локально);
- HTTP‑эндпоинты `/profile` и `/profile/analysis` для интеграции с другими приложениями;
- кеширование расчёта личных месяцев для быстрых повторных запросов;
- готовая сцена Godot для ручного ввода данных и просмотра результатов.

## Требования

- Python 3.10+
- установленный `pip`
- (для анализа) ключ OpenRouter: https://openrouter.ai/
- (по желанию) Godot 4 для запуска графического интерфейса

## Быстрый старт

```bash
python -m venv .venv
# Windows
.\.venv\Scripts\activate
# macOS / Linux
source .venv/bin/activate
pip install -r requirements.txt
```

Создайте файл `.env` в корне проекта:

```
OPENROUTER_API_KEY=ваш_ключ
```

Без ключа сервис продолжит работать, но текст анализа будет заглушкой из `MockAIClient`.
Если ключ отсутствует или задан некорректно, API вернёт сообщение «Анализ временно недоступен: …» с указанием причины.

## Запуск API

```bash
uvicorn api:app --reload --port 8000
```

Доступные эндпоинты:

- `POST /profile` — возвращает только числовой профиль;
- `POST /profile/analysis` — возвращает профиль и текст, сформированный AI.

Пример запроса:

```bash
curl -X POST http://127.0.0.1:8000/profile   -H "Content-Type: application/json"   -d '{"full_name": "Иван Иванов", "birthdate": "01.02.1990"}'
```

## Двухэтапный сценарий в Godot

1. Запустите сервер (см. выше) и откройте сцену `numbers-gui/main.tscn` в Godot 4.
2. Введите ФИО и дату. Кнопка «Профиль» отправит запрос на `/profile` и покажет только числа.
3. После получения чисел активируется кнопка «ИИ-анализ профиля». Она вызывает `/profile/analysis` и добавляет текстовый разбор под уже полученным профилем.
4. Если в ResultLabel появляется «Ошибка сети: 2», проверьте, что сервер слушает `http://127.0.0.1:8000` и не блокируется брандмауэром.

Адрес сервера задаётся в `numbers-gui/main.gd` константами `PROFILE_ENDPOINT` и `ANALYSIS_ENDPOINT`.

## Тесты

```bash
python -m pytest numbers_core/tests
```

## FAQ

**Можно ли работать без интернета?** Да, числовой профиль вычисляется локально. Для текста от AI нужен доступ к OpenRouter.

**Как поменять язык или стиль текста?** Отредактируйте Markdown‑шаблоны в `numbers_core/intelligence/prompts`.

**Где изменить подсказки для Godot?** Основной скрипт находится в `numbers-gui/main.gd`.

**Что делать, если API вернуло ошибку валидации?** Проверьте, что имя содержит только буквы (допустимы дефис и апостроф), а дата соответствует одному из форматов: `YYYY-MM-DD`, `DD.MM.YYYY`, `DD/MM/YYYY`, `DD-MM-YYYY`. Сообщение об ошибке подскажет, какой параметр нужно исправить.

**Как понять, что анализ от AI не сработал?** В ответе появится строка «Анализ временно недоступен» с текстом причины (например, отсутствует `OPENROUTER_API_KEY`).

## Обратная связь

Создавайте issue или pull request, если нашли проблему или хотите предложить улучшение.
