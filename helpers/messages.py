# utils/messages.py


class BTN:
    CORE = "üìÑ –Ø–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏"
    EXTENDED = "üß© –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞"
    BRIDGES = "ü™Ñ –ú–æ—Å—Ç—ã"
    CYCLES = "üåÄ –¶–∏–∫–ª—ã –∏ –≥–æ–¥—ã"
    MONTHS = "üìÜ –ê–Ω–∞–ª–∏–∑ –º–µ—Å—è—Ü–µ–≤"
    CALENDAR_DAYS = "üìÖ –ö–∞–ª–µ–Ω–¥–∞—Ä—å –¥–Ω–µ–π"
    PARTNER = "üíû –°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å –ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤"
    RESTART = "üîÅ –°—Ç–∞—Ä—Ç"


class FILENAMES:
    """–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è PDF —Ñ–∞–π–ª–æ–≤."""
    CORE_PROFILE = "–Ø–¥—Ä–æ_–ª–∏—á–Ω–æ—Å—Ç–∏.pdf"
    EXTENDED_PROFILE = "–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ_—á–∏—Å–ª–∞.pdf"
    BRIDGES = "–ê–Ω–∞–ª–∏–∑_–º–æ—Å—Ç–æ–≤.pdf"
    CYCLES = "–¶–∏–∫–ª—ã_–∏_–≥–æ–¥—ã.pdf"
    MONTHS = "–ê–Ω–∞–ª–∏–∑_–º–µ—Å—è—Ü–µ–≤.pdf"
    CALENDAR_DAYS = "–ö–∞–ª–µ–Ω–¥–∞—Ä—å_–¥–Ω–µ–π.pdf"
    PARTNER_COMPATIBILITY = "–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å_–ø–∞—Ä—Ç–Ω—ë—Ä–æ–≤.pdf"


class M:
    # ===== –ü—Ä–æ–≥—Ä–µ—Å—Å / —Å—Ç–∞—Ç—É—Å—ã =====
    class PROGRESS:
        CALC_LABEL = "‚öôÔ∏è –°—á–∏—Ç–∞—é —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏‚Ä¶"
        AI_LABEL = "ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ü–∏—é‚Ä¶"
        AI_ANALYSIS = "ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∞–Ω–∞–ª–∏–∑ –º–µ—Å—è—Ü–∞/–≥–æ–¥–∞..."
        AI_CALENDAR = "ü§ñ –ì–µ–Ω–µ—Ä–∏—Ä—É—é –∞–Ω–∞–ª–∏–∑ –∫–∞–ª–µ–Ω–¥–∞—Ä—è..."
        PDF_ONE = "üìù –§–æ—Ä–º–∏—Ä—É—é –æ—Ç—á—ë—Ç‚Ä¶"
        SENDING_ONE = "üì§ –û—Ç–ø—Ä–∞–≤–ª—è—é –æ—Ç—á—ë—Ç‚Ä¶"
        PREPARE_MONTHS = "üìÜ –ì–æ—Ç–æ–≤–ª—é –∞–Ω–∞–ª–∏–∑ –º–µ—Å—è—Ü–µ–≤ –Ω–∞ {year} –≥–æ–¥..."
        PREPARE_CALENDAR = "üìÖ –ì–æ—Ç–æ–≤–ª—é –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–Ω–µ–π –Ω–∞ {month} {year}..."
        PREPARE_CYCLES = "üîÑ –ì–æ—Ç–æ–≤–ª—é –∞–Ω–∞–ª–∏–∑ –ø–æ —Ü–∏–∫–ª–∞–º –∏ –≥–æ–¥–∞–º..."
        DONE = "‚úÖ –û—Ç—á—ë—Ç –≥–æ—Ç–æ–≤!"
        FAIL = "‚ö†Ô∏è –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞."

    # ===== –ü–æ–¥—Å–∫–∞–∑–∫–∏/—Ä–µ–ø–ª–∏–∫–∏ =====
    class HINTS:
        GREETING = "–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ç–≤–æ—ë —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏–∏."
        CALC_CORE_FIRST = "–°–Ω–∞—á–∞–ª–∞ —Ä–∞—Å—Å—á–∏—Ç–∞–µ–º —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏."
        ASK_NAME = "–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç (–§–∞–º–∏–ª–∏—è –ò–º—è –û—Ç—á–µ—Å—Ç–≤–æ)?"
        ASK_NAME_FULL = "–ü—Ä–∏–≤–µ—Ç! –Ø –ø–æ–º–æ–≥—É —Ä–∞—Å—Å—á–∏—Ç–∞—Ç—å —Ç–≤–æ—ë —è–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏ –ø–æ –Ω—É–º–µ—Ä–æ–ª–æ–≥–∏–∏.\n\n–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç (–§–∞–º–∏–ª–∏—è, –ò–º—è, –û—Ç—á–µ—Å—Ç–≤–æ)?"
        ASK_BIRTHDATE = "üìÖ –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì (–Ω–∞–ø—Ä–∏–º–µ—Ä 24.02.1993). –ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ 1993-02-24 –∏–ª–∏ 24/02/1993."
        ASK_BIRTHDATE_COMPACT = "üìÖ –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì (–Ω–∞–ø—Ä–∏–º–µ—Ä 24.02.1993).–ú–æ–∂–Ω–æ —Ç–∞–∫–∂–µ 1993-02-24 –∏–ª–∏ 24/02/1993."
        ASK_PARTNER_NAME = "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ —Ñ–∞–º–∏–ª–∏—é –≤—Ç–æ—Ä–æ–≥–æ –ø–∞—Ä—Ç–Ω—ë—Ä–∞:"
        ASK_PARTNER_BIRTHDATE = "üìÖ –í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ –î–î.–ú–ú.–ì–ì–ì–ì (–Ω–∞–ø—Ä–∏–º–µ—Ä 24.02.1993)."
        REENTER_NAME = "–í–≤–µ–¥–∏—Ç–µ –∏–º—è –µ—â—ë —Ä–∞–∑:"
        REENTER_DATE = "–í–≤–µ–¥–∏—Ç–µ –¥–∞—Ç—É –µ—â—ë —Ä–∞–∑:"
        NEXT_STEP = "–í—ã–±–µ—Ä–∏—Ç–µ —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥:"
        MISSING_DATA = "‚ö†Ô∏è –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–∞—Å—á—ë—Ç–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ."
        MISSING_BASIC_DATA = "‚ö†Ô∏è –°–Ω–∞—á–∞–ª–∞ –≤–≤–µ–¥–∏—Ç–µ –∏–º—è –∏ –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è."
        MISSING_YEAR = "‚ö†Ô∏è –ù–µ —Ö–≤–∞—Ç–∞–µ—Ç –≥–æ–¥–∞ –¥–ª—è –∞–Ω–∞–ª–∏–∑–∞. –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –Ω–∞—á–Ω–∏—Ç–µ –∑–∞–Ω–æ–≤–æ."
        MISSING_PARTNER_DATA = "‚ùå –ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å –¥–∞—Ç—É —Ä–æ–∂–¥–µ–Ω–∏—è –ø–∞—Ä—Ç–Ω—ë—Ä–∞."
        RETRY_DATE = "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑. –ü—Ä–∏–º–µ—Ä—ã: 24.02.1993, 1993-02-24, 24/02/1993."
        RETRY_PARTNER_DATE = "–ü–æ–ø—Ä–æ–±—É–π—Ç–µ –µ—â—ë —Ä–∞–∑. –ü—Ä–∏–º–µ—Ä: 24.02.1993"

    # ===== –ü–æ–¥—Å–∫–∞–∑–∫–∞ –ø–æ —Ñ–æ—Ä–º–∞—Ç–∞–º –¥–∞—Ç =====
    DATE_FORMATS_NOTE = (
        "–ü—Ä–∏–º–µ—Ä—ã –¥–æ–ø—É—Å—Ç–∏–º—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤: 24.02.1993, 24/02/1993, 1993-02-24, 24-02-1993."
    )

    # ===== –û—à–∏–±–∫–∏ (–µ–¥–∏–Ω—ã–π —Å—Ç–∏–ª—å) =====
    class ERRORS:
        # –û–±—â–∏–µ –æ—à–∏–±–∫–∏
        PREFIX = "‚ùå –û—à–∏–±–∫–∞: "
        GENERIC_ERROR = "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ –∑–∞–ø—Ä–æ—Å–∞."
        
        # –û—à–∏–±–∫–∏ –∏–º–µ–Ω –∏ –¥–∞—Ç
        NAME_PREFIX = "‚ùå –ü—Ä–æ–±–ª–µ–º–∞ —Å –∏–º–µ–Ω–µ–º: "
        NAME_RULES = "–ò–º—è –¥–æ–ª–∂–Ω–æ —Å–æ–¥–µ—Ä–∂–∞—Ç—å —Ç–æ–ª—å–∫–æ –∫–∏—Ä–∏–ª–ª–∏—Ü—É, –ø—Ä–æ–±–µ–ª –∏ –¥–µ—Ñ–∏—Å."
        DATE_PREFIX = "‚ùå –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –¥–∞—Ç–∞: "
        DATE_FUTURE = "–î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è –Ω–µ –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ –±—É–¥—É—â–µ–º."
        
        # –û—à–∏–±–∫–∏ —Ä–∞—Å—á–µ—Ç–æ–≤
        CALC_PROFILE = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ –ø—Ä–æ—Ñ–∏–ª—è."
        CALC_EXTENDED = "‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã—Ö —á–∏—Å–µ–ª."
        CALC_CYCLES = "‚ùå –ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞ –ø—Ä–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–∏ –∞–Ω–∞–ª–∏–∑–∞ —Ü–∏–∫–ª–æ–≤."
        
        # –û—à–∏–±–∫–∏ PDF –∏ —Ñ–∞–π–ª–æ–≤
        PDF_FAIL = "‚ö†Ô∏è –ù–µ —É–¥–∞–ª–æ—Å—å —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞—Ç—å PDF."
        
        # –û—à–∏–±–∫–∏ AI
        AI_GENERIC = "–ê–Ω–∞–ª–∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω. –í—ã –º–æ–∂–µ—Ç–µ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å –ø–æ–∑–∂–µ."
        AI_NO_KEY = "‚ùå –û—à–∏–±–∫–∞: –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç API-–∫–ª—é—á OpenRouter. –ü—Ä–æ–≤–µ—Ä—å .env."
        AI_EMPTY = "–û—à–∏–±–∫–∞: AI –∞–Ω–∞–ª–∏–∑ –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω"
        AI_UNEXPECTED = "‚ùå –ù–µ–æ–∂–∏–¥–∞–Ω–Ω—ã–π –æ—Ç–≤–µ—Ç –æ—Ç API"
        
        # –û—à–∏–±–∫–∏ —Å–µ—Ç–∏ –∏ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
        NO_TOKEN = "‚ùå –û—à–∏–±–∫–∞: –ù–µ –Ω–∞–π–¥–µ–Ω TELEGRAM_TOKEN"
        STARTUP_ERROR = "‚ùå –û—à–∏–±–∫–∞ –∑–∞–ø—É—Å–∫–∞"
        NETWORK_ERROR = "‚ùå –°–µ—Ç–µ–≤–∞—è –æ—à–∏–±–∫–∞"
        API_ERROR = "‚ùå –û—à–∏–±–∫–∞ API"

    # ===== –ü—Ä–æ—Å—Ç—ã–µ –ø–æ–¥–ø–∏—Å–∏ –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞–º =====
    DOCUMENT_READY = "‚úÖ"  # –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è –ø–æ–¥–ø–∏—Å—å –¥–ª—è –≤—Å–µ—Ö –¥–æ–∫—É–º–µ–Ω—Ç–æ–≤

    # ===== –û–ø–∏—Å–∞–Ω–∏—è —Ü–≤–µ—Ç–Ω—ã—Ö –º–µ—Ç–æ–∫ –∫–∞–ª–µ–Ω–¥–∞—Ä—è =====
    class CALENDAR_LEGENDS:
        LIFE_PATH = "üü• –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—É—Ç—å ‚Äî —Ç–µ–º–∞ –ø—Ä–µ–¥–Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è, —Å—É–¥—å–±–æ–Ω–æ—Å–Ω—ã–µ –∞–∫—Ü–µ–Ω—Ç—ã"
        EXPRESSION = "üü¶ –í—ã—Ä–∞–∂–µ–Ω–∏–µ ‚Äî —ç–Ω–µ—Ä–≥–∏—è –¥–µ–π—Å—Ç–≤–∏—è, —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª–∞"
        SOUL = "üü£ –î—É—à–∞ ‚Äî –≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∂–µ–ª–∞–Ω–∏—è –∏ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ –∏–º–ø—É–ª—å—Å—ã"
        PERSONALITY = "üü® –õ–∏—á–Ω–æ—Å—Ç—å ‚Äî —Å—Ç–∏–ª—å –ø–æ–≤–µ–¥–µ–Ω–∏—è, –∫–∞–∫ –≤–∞—Å –≤–∏–¥—è—Ç –æ–∫—Ä—É–∂–∞—é—â–∏–µ"
        BIRTHDAY = "üü© –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è ‚Äî –≤—Ä–æ–∂–¥—ë–Ω–Ω—ã–µ –¥–∞—Ä—ã, –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è —Å–ø–æ–Ω—Ç–∞–Ω–Ω–æ—Å—Ç–∏"

    # ===== –§–æ—Ä–º–∞—Ç—Ç–µ—Ä—ã –¥–ª—è –∫—Ä–∞—Ç–∫–∏—Ö –ø—Ä–µ–≤—å—é =====
    @staticmethod
    def format_core_summary(name: str, birthdate: str, profile: dict) -> str:
        title_map = {
            "life_path": "üî¢ –ñ–∏–∑–Ω–µ–Ω–Ω—ã–π –ø—É—Ç—å",
            "birthday": "üìÖ –î–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è",
            "expression": "üß¨ –í—ã—Ä–∞–∂–µ–Ω–∏–µ",
            "soul": "üíñ –î—É—à–∞",
            "personality": "üé≠ –õ–∏—á–Ω–æ—Å—Ç—å",
        }
        lines = [f"üîπ *–Ø–¥—Ä–æ –ª–∏—á–Ω–æ—Å—Ç–∏ –¥–ª—è {name}*", f"üìÜ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: {birthdate}", ""]
        for k, label in title_map.items():
            if k in profile:
                lines.append(f"{label}: {profile[k]}")
        return "\n".join(lines)

    @staticmethod
    def format_extended_summary(name: str, birthdate: str, extended: dict) -> str:
        labels = {
            "balance": "‚öñÔ∏è –ë–∞–ª–∞–Ω—Å",
            "growth": "üå± –†–æ—Å—Ç",
            "realization": "üéØ –†–µ–∞–ª–∏–∑–∞—Ü–∏—è",
            "mind": "üß† –†–∞–∑—É–º",
        }
        lines = [f"üß© *–†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —á–∏—Å–ª–∞ –¥–ª—è {name}*", f"üìÜ –î–∞—Ç–∞ —Ä–æ–∂–¥–µ–Ω–∏—è: {birthdate}", ""]
        for k, label in labels.items():
            if k in extended:
                lines.append(f"{label}: {extended[k]}")
        return "\n".join(lines)

    # ===== –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –æ—à–∏–±–æ–∫ =====
    @staticmethod
    def format_error(error_message: str, context: str = None) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É —Å –∫–æ–Ω—Ç–µ–∫—Å—Ç–æ–º."""
        if context:
            return f"{M.ERRORS.PREFIX}{error_message}\n{context}"
        return f"{M.ERRORS.PREFIX}{error_message}"
    
    @staticmethod
    def format_error_details(base_error: str, details: str) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É —Å –ø–æ–¥—Ä–æ–±–Ω–æ—Å—Ç—è–º–∏."""
        return f"{base_error}\n–ü–æ–¥—Ä–æ–±–Ω–æ—Å—Ç–∏: {details}"
    
    @staticmethod
    def format_api_error(status: int, reason: str) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –æ—à–∏–±–∫—É API."""
        return f"{M.ERRORS.API_ERROR} {status}: {reason}"
    
    @staticmethod
    def format_network_error(error: str) -> str:
        """–§–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–µ—Ç–µ–≤—É—é –æ—à–∏–±–∫—É."""
        return f"{M.ERRORS.NETWORK_ERROR}: {error}"
    
    @staticmethod
    def is_ai_error(response: str) -> bool:
        """–ü—Ä–æ–≤–µ—Ä—è–µ—Ç, —è–≤–ª—è–µ—Ç—Å—è –ª–∏ –æ—Ç–≤–µ—Ç AI –æ—à–∏–±–∫–æ–π."""
        if not isinstance(response, str):
            return False
        return (
            response.startswith("‚ùå") or 
            response == M.ERRORS.AI_GENERIC or
            response == M.ERRORS.AI_EMPTY or
            response == M.ERRORS.AI_NO_KEY or
            response == M.ERRORS.AI_UNEXPECTED
        )
    
    @staticmethod
    async def send_auto_delete_error(update, context, error_text: str, delete_after: float = 5.0, **kwargs):
        """–û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ –æ–± –æ—à–∏–±–∫–µ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º —É–¥–∞–ª–µ–Ω–∏–µ–º."""
        from .progress import MessageManager
        msg_manager = MessageManager(context)
        return await msg_manager.send_error_and_track(update, error_text, delete_after, **kwargs)
